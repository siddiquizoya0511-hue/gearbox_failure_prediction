# -*- coding: utf-8 -*-
"""gearbox_failure_prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1oizvLVJUH5vMjCzTDKtwsR10qyH9Whdl
"""

#drive mount
from google.colab import drive
drive.mount('/content/drive')

import pandas as pd

Filepth="/content/drive/MyDrive/workshop/datasets.z/gearbox failure dataset (1).csv"
data=pd.read_csv(Filepth)

data.head(5)

data.shape

data.columns

data.tail()

data.info()

data.describe()

data.skew(numeric_only=True)

data.isnull().sum()

data['Load_%'].unique()

data['Temperature_C'].unique()

data['Vibration_mm_s'].unique()

data['Oil_Level_%'].unique()

data['Failure'].unique()

print(data.duplicated().sum())

import seaborn as sns
import matplotlib.pyplot as plt

sns.histplot(data['Failure'])
plt.show()

sns.histplot(data['Load_%'])
plt.show()

sns.histplot(data['Oil_Level_%'])
plt.show()

sns.histplot(data['Temperature_C'])
plt.show()

sns.histplot(data['Vibration_mm_s'])
plt.show()

"""**Data** **Visualization**"""

plt.figure(figsize=(10,10))
sns.histplot(data["Load_%"],color="cyan")
plt.title("Histogram of Load_%")
plt.show()

plt.figure(figsize=(10,10))
sns.histplot(data["Temperature_C"],color="blue")
plt.title("Histogram of Temperature_C")
plt.show()

plt.figure(figsize=(10,10))
sns.histplot(data["Vibration_mm_s"],color="black")
plt.title("Histogram of Vibration_mm_s")
plt.show()

plt.figure(figsize=(10,10))
sns.histplot(data["Oil_Level_%"],color="purple")
plt.title("Histogram of Oil_Level_%")
plt.show()

plt.figure(figsize=(10,10))
sns.histplot(data["Failure"],color="green")
plt.title("Histogram of Failure")
plt.show()

sns.scatterplot(data=data,x="Load_%",y="Temperature_C",color="black")
plt.xlabel("Load_%")
plt.ylabel("Temperature_C")
plt.title("Scatterplot of Load_% vs Temperature_C")
plt.show()

sns.scatterplot(data=data,x="Vibration_mm_s",y="Oil_Level_%",color="blue")
plt.xlabel("Vibration_mm_s")
plt.ylabel("Oil_Level_%")
plt.title("Scatterplot of Vibration_mm_s vs Oil_Level_%")
plt.show()

sns.scatterplot(data=data,x="Failure",y="Load_%",color="black")
plt.xlabel("Failure")
plt.ylabel("Load_%")
plt.title("Scatterplot of Failure vs Load_%")
plt.show()

from sklearn.preprocessing import LabelEncoder
le=LabelEncoder()

sns.heatmap(data.corr(), annot= True, cmap="viridis")
plt.show()

data.skew(numeric_only=True)

import numpy as np

data['Failure']=np.sqrt(data['Failure'])

x=data.drop(['Failure'],axis=1)
y=data['Failure']

data['Failure'].value_counts()

from sklearn.model_selection import train_test_split
x_train, x_test , y_train, y_test = train_test_split (x,y,test_size=0.2, stratify=y, random_state=42)

x.columns

#logistic regression
from sklearn.linear_model import LogisticRegression
lr = LogisticRegression()
lr.fit(x_train,y_train)

y_pred_lr=lr.predict(x_test)

#accuracy
from sklearn.metrics import accuracy_score
acc_lr = accuracy_score(y_test,y_pred_lr)
print(acc_lr)

#confusion matrix
from sklearn.metrics import confusion_matrix
cm_lr = confusion_matrix(y_test,y_pred_lr)

import seaborn as sns
import matplotlib.pyplot as plt
#visualize cm
sns.heatmap(cm_lr,annot=True,cmap="coolwarm" , fmt="d")
plt.title("Confusion Matrix")
plt.show()

#decision tress regressior
from sklearn.tree import DecisionTreeClassifier
dt = DecisionTreeClassifier()
dt.fit(x_train,y_train)

y_pred_dt = dt.predict(x_test)

#accuracy
from sklearn.metrics import accuracy_score
acc_dt = accuracy_score(y_test,y_pred_dt)
print(acc_dt)

#confusion  matrix for decision tree regresior
from sklearn.metrics import confusion_matrix
cm_dt = confusion_matrix(y_test,y_pred_dt)
sns.heatmap(cm_dt,annot=True,cmap="coolwarm" , fmt="d")
plt.title("Confusion Matrix")
plt.show()

#random forest classifier
from sklearn.ensemble import RandomForestClassifier
rf = RandomForestClassifier()
rf.fit(x_train,y_train)

y_pred_rf = rf.predict(x_test)

#accuracy
from sklearn.metrics import accuracy_score
acc_rf = accuracy_score(y_test,y_pred_rf)
print(acc_rf)

#CONFUSSION MATRIX OF random forset classifier
from sklearn.metrics import confusion_matrix
cm_rf = confusion_matrix(y_test,y_pred_rf)
sns.heatmap(cm_rf,annot=True,cmap="coolwarm" , fmt="d")
plt.title("Confusion Matrix")
plt.show()

#xgboost classifier
from xgboost import XGBClassifier
xgb = XGBClassifier()
xgb.fit(x_train,y_train)

y_pred_xgb= xgb.predict(x_test)

#accuracy
from sklearn.metrics import accuracy_score
acc_xgb = accuracy_score(y_test,y_pred_xgb)
print(acc_xgb)

#confussion matrix of xgboost classifier
from sklearn.metrics import confusion_matrix
cm_xgb = confusion_matrix(y_test,y_pred_xgb)
sns.heatmap(cm_xgb,annot=True,cmap="coolwarm" , fmt="d")
plt.title("Confusion Matrix")
plt.show()

# model interpretation
import pandas as pd
importance = pd.Series(rf.feature_importances_, index=x.columns)

importance.sort_values().plot(kind='barh' , title="Feature Importance")
plt.show()

#dowload rf model usind joblib
import joblib
joblib.dump(rf,"gearbox_failure_prediction.pkl")

['gearbox-failure.pkl']

from google.colab import files
files.download('gearbox_failure_prediction.pkl')

!pip install streamlit

from google.colab import drive
drive.mount('/content/drive')

# import libraries
import numpy as np
import joblib
import streamlit as st

# gearbox_failure_prediction.pkl.

model = joblib.load('gearbox_failure_prediction.pkl')

st.set_page_config(page_title='Gearbox failure Classification', layout="centered")
st.title('Gearbox failure Classification App')
st.write("Predict the Faiure rate")

Load_%	= st.number_input("Value of Load_%", value=None)
Temperature_C = st.number_input("Value of Temperature_C,", value=None)
Vibration_mm_s	= st.number_input("Value of Vibration_mm_s,", value=None)
Oil_Level_% = st.number_input("Value of Oil_Level_%,", value=None)


if st.button('Predict'):
  input_data = np.array([[Load_%,
                          Temperature_C,
                          Vibration_mm_s,
                          Oil_Level_%
                          ]])
  prediction = model.predict(input_data)[0]
  if prediction == 0:
    st.success('Fail')
  else:
    st.success('Pass')







